/*! Fabrik */

define(["jquery","fab/fabrik"],function(a,b){"use strict";return new Class({options:{publicKey:"",item:"",zipCode:!0,allowRememberMe:!1,email:"",name:"",panelLabel:"",useCheckout:!0,billingAddress:!1},initialize:function(c){if(this.options=a.extend(this.options,c),this.form=b.getBlock("form_"+this.options.formid),b.FabrikStripeForm=null,b.FabrikStripeFormSubmitting=!1,this.options.useCheckout)this.handler=StripeCheckout.configure({key:this.options.publicKey,image:"https://stripe.com/img/documentation/checkout/marketplace.png",locale:"auto",token:function(a,c){b.FabrikStripeForm.form.adopt(new Element("input",{name:"stripe_token_id",value:a.id,type:"hidden"})),b.FabrikStripeForm.form.adopt(new Element("input",{name:"stripe_token_email",value:a.email,type:"hidden"})),b.FabrikStripeForm.form.adopt(new Element("input",{name:"stripe_token_opts",value:JSON.stringify(c),type:"hidden"})),b.FabrikStripeForm.mockSubmit()},closed:function(){b.FabrikStripeFormSubmitting=!0}}),b.addEvent("fabrik.form.submit.start",function(c,d,e){void 0!==b.FabrikStripeForm&&!0===b.FabrikStripeFormSubmitting&&0!==a("input[name=stripe_token_id]").length||(b.FabrikStripeForm=c,this.handler.open({name:this.options.name,description:this.options.item,amount:this.options.amount,zipCode:this.options.zipCode,allowRememberMe:this.options.allowRememberMe,email:this.options.email,panelLabel:this.options.panelLabel,billingAddress:this.options.billingAddress}),d.preventDefault(),c.result=!1)}.bind(this)),window.addEventListener("popstate",function(){this.handler.close()});else if(this.options.updateCheckout){var d=this.form.form.getElement(".fabrikStripeChange");"null"!==typeOf(d)&&(this.handler=StripeCheckout.configure({key:this.options.publicKey,image:"https://stripe.com/img/documentation/checkout/marketplace.png",locale:"auto",token:function(c,d){b.FabrikStripeForm.form.adopt(new Element("input",{name:"stripe_token_id",value:c.id,type:"hidden"})),b.FabrikStripeForm.form.adopt(new Element("input",{name:"stripe_token_email",value:c.email,type:"hidden"})),b.FabrikStripeForm.form.adopt(new Element("input",{name:"stripe_token_opts",value:JSON.stringify(d),type:"hidden"})),a(".fabrikStripeLast4").text(Joomla.JText._("PLG_FORM_STRIPE_CUSTOMERS_UPDATE_CC_UPDATED"))}}),d.addEvent("click",function(a){a.preventDefault(),b.FabrikStripeForm=this.form,this.handler.open({name:this.options.name,description:this.options.item,zipCode:this.options.zipCode,allowRememberMe:this.options.allowRememberMe,email:this.options.email,panelLabel:this.options.panelLabel,billingAddress:this.options.billingAddress})}.bind(this)))}}})});