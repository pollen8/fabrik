/*! Fabrik */
var FbPicklist=new Class({Extends:FbElement,initialize:function(a,b){this.plugin="fabrikpicklist",this.parent(a,b),this.options.allowadd===!0&&(this.watchAddToggle(),this.watchAdd()),this.makeSortable()},makeSortable:function(){if(this.options.editable){var a=this.getContainer(),b=a.getElement(".fromList"),c=a.getElement(".toList"),d=b.getStyle("background-color"),e=this;this.sortable=new Sortables([b,c],{clone:!0,revert:!0,opacity:.7,hovercolor:"#ffddff",onComplete:function(a){this.setData(),this.showNotices(a),e.fadeOut(b,d),e.fadeOut(c,d)}.bind(this),onSort:function(a,b){this.showNotices(a,b)}.bind(this),onStart:function(){this.drag.addEvent("onEnter",function(a,f){this.lists.contains(f)&&(e.fadeOut(f,this.options.hovercolor),this.lists.contains(this.drag.overed)&&this.drag.overed.addEvent("mouseleave",function(){e.fadeOut(b,d),e.fadeOut(c,d)}.bind(this)))}.bind(this))}});var f=[b.getElement("li.emptypicklist"),c.getElement("li.emptypicklist")];this.sortable.removeItems(f),this.showNotices()}},fadeOut:function(a,b){var c=new Fx.Tween(a,{wait:!1,duration:600});c.start("background-color",b)},showNotices:function(a){a&&(a=a.getParent("ul"));var b,c,d,e=this.getContainer(),f=[e.getElement(".fromList"),e.getElement(".toList")];for(d=0;d<f.length;d++){c=f[d],b=c===a||"null"===typeOf(a)?1:2;var g=c.getElement("li.emptypicklist"),h=c.getElements("li");h.length>b?g.hide():g.show()}},setData:function(){var a=this.getContainer(),b=a.getElement(".toList"),c=b.getElements("li[class!=emptypicklist]"),d=c.map(function(a){return a.id.replace(this.options.element+"_value_","")}.bind(this));this.element.value=JSON.encode(d)},watchAdd:function(){var a=(this.element.id,this.getContainer()),b=a.getElement(".toList"),c=a.getElement("input[type=button]");"null"!==typeOf(c)&&c.addEvent("click",function(c){var d;if(value=a.getElement("input[name=addPicklistValue]"),labelEl=a.getElement("input[name=addPicklistLabel]"),label=labelEl.get("value"),d="null"!==typeOf(value)?value.value:label,""===d||""===label)alert(Joomla.JText._("PLG_ELEMENT_PICKLIST_ENTER_VALUE_LABEL"));else{var e=new Element("li",{"class":"picklist",id:this.element.id+"_value_"+d}).set("text",label);b.adopt(e),this.sortable.addItems(e),c.stop(),"element"===typeOf(value)&&(value.value=""),labelEl.value="",this.setData(),this.addNewOption(d,label),this.showNotices()}}.bind(this))},unclonableProperties:function(){return["form","sortable"]},watchAddToggle:function(){var a=this.getContainer(),b=a.getElement("div.addoption"),c=a.getElement(".toggle-addoption");if(this.mySlider){var d=b.clone(),e=a.getElement(".fabrikElement");b.getParent().destroy(),e.adopt(d),b=a.getElement("div.addoption"),b.setStyle("margin",0)}this.mySlider=new Fx.Slide(b,{duration:500}),this.mySlider.hide(),c.addEvent("click",function(a){a.stop(),this.mySlider.toggle()}.bind(this))},cloned:function(a){delete this.sortable,this.options.allowadd===!0&&(this.watchAddToggle(),this.watchAdd()),this.makeSortable(),this.parent(a)}});