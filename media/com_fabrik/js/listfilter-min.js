/*! Fabrik */
var FbListFilter=new Class({Implements:[Events],options:{container:"",type:"list",id:"",ref:"",advancedSearch:{controller:"list"}},initialize:function(a){var b,c=this;this.filters={},this.options=jQuery.extend(this.options,a),this.advancedSearch=!1,this.container=jQuery("#"+this.options.container),this.filterContainer=this.container.find(".fabrikFilterContainer"),this.filtersInHeadings=this.container.find(".listfilter");var d=this.container.find(".toggleFilters");if(d.on("click",function(a){a.stopPropagation(),c.filterContainer.toggle(),c.filtersInHeadings.toggle()}),d.length>0&&(this.filterContainer.hide(),this.filtersInHeadings.toggle()),0!==this.container.length){this.getList();var e=this.container.find(".clearFilters");e.off(),e.on("click",function(a){a.stopPropagation(),c.container.find(".fabrik_filter").each(function(a){c.clearAFilter(a)}),c.clearPlugins(),c.submitClearForm()}),(b=this.container.find(".advanced-search-link"))&&b.on("click",function(a){a.preventDefault();var b,d=jQuery(a.target);"A"!==d.prop("tagName")&&(d=d.closest("a"));var e=d.prop("href");e+="&listref="+c.options.ref,b={id:"advanced-search-win"+c.options.ref,modalId:"advanced-filter",title:Joomla.JText._("COM_FABRIK_ADVANCED_SEARCH"),loadMethod:"xhr",evalScripts:!0,contentURL:e,width:710,height:340,y:c.options.popwiny,onContentLoaded:function(){var a=Fabrik.blocks["list_"+c.options.ref];void 0===a&&(a=Fabrik.blocks[c.options.container],c.options.advancedSearch.parentView=c.options.container),a.advancedSearch=new AdvancedSearch(c.options.advancedSearch),f.fitToContent(!1)}};var f=Fabrik.getWindow(b)}),this.filterContainer.find(".advancedSelect").each(function(){jQuery("#"+this.id).on("change",{changeEvent:"change"},function(a){jQuery("#"+this.id).fireEvent(a.data.changeEvent,new Event.Mock(document.getElementById(this.id),a.data.changeEvent))})}),this.watchClearOne()}},getList:function(){return this.list=Fabrik.blocks[this.options.type+"_"+this.options.ref],void 0===this.list&&(this.list=Fabrik.blocks[this.options.container]),this.list},addFilter:function(a,b){this.filters.hasOwnProperty(a)===!1&&(this.filters[a]=[]),this.filters[a].push(b)},onSubmit:function(){this.filters.date&&jQuery.each(this.filters.date,function(a,b){b.onSubmit()})},onUpdateData:function(){this.filters.date&&jQuery.each(this.filters.date,function(a,b){b.onUpdateData()})},getFilterData:function(){var a={};return this.container.find(".fabrik_filter").each(function(){if(jQuery(this).prop("id").test(/value$/)){var b=$(this).prop("id").match(/(\S+)value$/)[1];a[b]="SELECT"===jQuery(this).prop("tagName")&&-1!==this.selectedIndex?jQuery("#"+this.options[this.selectedIndex]).text():jQuery(this).val(),a[b+"_raw"]=jQuery(this).val()}}),a},update:function(){jQuery.each(this.filters,function(a,b){b.each(function(a){a.update()})})},clearAFilter:function(a){(a.name&&(a.name.contains("[value]")||a.name.contains("fabrik_list_filter_all"))||a.hasClass("autocomplete-trigger"))&&("select"===a.get("tag")?a.selectedIndex=a.get("multiple")?-1:0:"checkbox"===a.get("type")?a.checked=!1:a.value="")},clearPlugins:function(){var a=this.getList().plugins;null!==a&&a.each(function(a){a.clearFilter()})},submitClearForm:function(){var a="FORM"===this.container.prop("tagName")?this.container:this.container.find("form");jQuery("<input />").attr({name:"resetfilters",value:1,type:"hidden"}).inject(a),"list"===this.options.type?this.list.submit("list.clearfilter"):this.container.find("form[name=filter]").submit()},watchClearOne:function(){var a=this;this.container.find("*[data-filter-clear]").on("click",function(b){b.stopPropagation();var c=$(b.event.currentTarget).data("filter-clear"),d=$('*[data-filter-name="'+c+'"]');d.each(function(b){a.clearAFilter(b)}),a.submitClearForm()})}});