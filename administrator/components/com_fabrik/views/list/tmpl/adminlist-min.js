var ListPluginManager=new Class({Extends:PluginManager,type:"list",initialize:function(a,b){this.parent(a,b)}});var ListForm=new Class({Implements:[Options],options:{j3:true},initialize:function(a){var b;this.setOptions(a);this.watchTableDd();if(document.id("addAJoin")){document.id("addAJoin").addEvent("click",function(c){c.stop();this.addJoin()}.bind(this))}if(document.getElement("table.linkedLists")){b=document.getElement("table.linkedLists").getElement("tbody");new Sortables(b,{handle:".handle"})}if(document.getElement("table.linkedForms")){b=document.getElement("table.linkedForms").getElement("tbody");new Sortables(b,{handle:".handle"})}this.joinCounter=0;this.watchOrderButtons();this.watchDbName();this.watchJoins()},watchOrderButtons:function(){document.getElements(".addOrder").removeEvents("click");document.getElements(".deleteOrder").removeEvents("click");document.getElements(".addOrder").addEvent("click",function(a){a.stop();this.addOrderBy()}.bind(this));document.getElements(".deleteOrder").addEvent("click",function(a){a.stop();this.deleteOrderBy(a)}.bind(this))},addOrderBy:function(b){var a;if(b){a=b.target.getParent(".orderby_container")}else{a=document.getElement(".orderby_container")}a.clone().inject(a,"after");this.watchOrderButtons()},deleteOrderBy:function(a){if(document.getElements(".orderby_container").length>1){a.target.getParent(".orderby_container").dispose();this.watchOrderButtons()}},watchDbName:function(){if(document.id("database_name")){document.id("database_name").addEvent("blur",function(a){if(document.id("database_name").get("value")===""){document.id("tablename").disabled=false}else{document.id("tablename").disabled=true}})}},_buildOptions:function(c,b){var a=[];if(c.length>0){if(typeof(c[0])==="object"){c.each(function(d){if(d[0]===b){a.push(new Element("option",{value:d[0],selected:"selected"}).set("text",d[1]))}else{a.push(new Element("option",{value:d[0]}).set("text",d[1]))}})}else{c.each(function(d){if(d===b){a.push(new Element("option",{value:d,selected:"selected"}).set("text",d))}else{a.push(new Element("option",{value:d}).set("text",d))}})}}return a},watchTableDd:function(){if(document.id("tablename")){document.id("tablename").addEvent("change",function(e){var cid=document.getElement("input[name*=connection_id]").get("value");var table=document.id("tablename").get("value");var url="index.php?option=com_fabrik&format=raw&task=list.ajax_updateColumDropDowns&cid="+cid+"&table="+table;var myAjax=new Request({url:url,method:"post",onComplete:function(r){eval(r)}}).send()})}},watchFieldList:function(a){document.getElement("div[id^=table-sliders-data]").addEvent("change:relay(select[name*="+a+"])",function(c,b){this.updateJoinStatement(b.getParent("table").id.replace("join",""))}.bind(this))},_findActiveTables:function(){var a=document.getElements(".join_from").combine(document.getElements(".join_to"));a.each(function(c){var b=c.get("value");if(this.options.activetableOpts.indexOf(b)===-1){this.options.activetableOpts.push(b)}}.bind(this));this.options.activetableOpts.sort()},addJoin:function(j,t,z,n,m,g,A,p,f,k){var q,B,c,h;z=z?z:"left";A=A?A:"";n=n?n:"";m=m?m:"";g=g?g:"";j=j?j:"";t=t?t:"";k=k?k:false;if(k){q='checked="checked"';B=""}else{B='checked="checked"';q=""}this._findActiveTables();p=p?p:[["-",""]];f=f?f:[["-",""]];var a=new Element("tbody");var o=new Element("input",{readonly:"readonly",size:"2","class":"disabled readonly input-mini",name:"jform[params][join_id][]",value:t});var b=new Element("a",{href:"#","class":"btn btn-danger",events:{click:function(d){this.deleteJoin(d);return false}.bind(this)}});var w='<i class="icon-minus"></i> ';if(!this.options.j3){w+=Joomla.JText._("COM_FABRIK_DELETE")}b.set("html",w);z=new Element("select",{name:"jform[params][join_type][]","class":"inputbox input-mini"}).adopt(this._buildOptions(this.options.joinOpts,z));var l=new Element("select",{name:"jform[params][join_from_table][]","class":"inputbox join_from input-small"}).adopt(this._buildOptions(this.options.activetableOpts,A));j=new Element("input",{type:"hidden",name:"group_id[]",value:j});var x=new Element("select",{name:"jform[params][table_join][]","class":"inputbox join_to input-small"}).adopt(this._buildOptions(this.options.tableOpts,n));var s=new Element("select",{name:"jform[params][table_key][]","class":"table_key inputbox input-small"}).adopt(this._buildOptions(p,m));g=new Element("select",{name:"jform[params][table_join_key][]","class":"table_join_key inputbox input-small"}).adopt(this._buildOptions(f,g));var e='<fieldset class="radio"><input type="radio" id="joinrepeat'+this.joinCounter+'" value="1" name="jform[params][join_repeat]['+this.joinCounter+'][]" '+q+'/><label for="joinrepeat'+this.joinCounter+'">'+Joomla.JText._("JYES")+'</label><input type="radio" id="joinrepeatno'+this.joinCounter+'" value="0" name="jform[params][join_repeat]['+this.joinCounter+'][]" '+B+'/><label for="joinrepeatno'+this.joinCounter+'">'+Joomla.JText._("JNO")+"</label></fieldset>";if(this.options.j3){c=new Element("thead").adopt(new Element("tr").adopt([new Element("th").set("text","id"),new Element("th").set("text",Joomla.JText._("COM_FABRIK_JOIN_TYPE")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_FROM")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_TO")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_FROM_COLUMN")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_TO_COLUMN")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_REPEAT_GROUP_BUTTON_LABEL")),new Element("th")]));h=new Element("tr",{id:"join"+this.joinCounter}).adopt([new Element("td").adopt(o),new Element("td").adopt([j,z]),new Element("td").adopt(l),new Element("td").adopt(x),new Element("td").adopt(s),new Element("td").adopt(g),new Element("td").set("html",e),new Element("td").adopt(b)])}else{c=new Element("thead").adopt([new Element("tr",{events:{click:function(C){C.stop();var d=C.target.getParent(".adminform").getElement("tbody");Browser.ie?d.toggle():d.slide("toggle")}},styles:{cursor:"pointer"}}).adopt(new Element("td",{colspan:"2"}).adopt(new Element("div",{id:"join-desc-"+this.joinCounter,styles:{margin:"5px","background-color":"#fefefe",padding:"5px",border:"1px dotted #666666"}})))]);h=[new Element("tr").adopt([new Element("td").set("text","id"),new Element("td").adopt(o)]),new Element("tr").adopt([new Element("td").adopt([j]).set("text",Joomla.JText._("COM_FABRIK_JOIN_TYPE")),new Element("td").adopt(z)]),new Element("tr").adopt([new Element("td").set("text",Joomla.JText._("COM_FABRIK_FROM")),new Element("td").adopt(l)]),new Element("tr").adopt([new Element("td").set("text",Joomla.JText._("COM_FABRIK_TO")),new Element("td").adopt(x)]),new Element("tr").adopt([new Element("td").set("text",Joomla.JText._("COM_FABRIK_FROM_COLUMN")),new Element("td",{id:"joinThisTableId"+this.joinCounter}).adopt(s)]),new Element("tr").adopt([new Element("td").set("text",Joomla.JText._("COM_FABRIK_TO_COLUMN")),new Element("td",{id:"joinJoinTableId"+this.joinCounter}).adopt(g)]),new Element("tr").set("html","<td>"+Joomla.JText._("COM_FABRIK_REPEAT_GROUP_BUTTON_LABEL")+"</td><td>"+e+"</td>"),new Element("tr").adopt([new Element("td",{colspan:"2"}).adopt([b])])]}var u=this.options.j3?"table-striped":"adminform";var r=this.options.j3?"":"join"+this.joinCounter;var v=new Element("table",{"class":u+" table",id:r}).adopt([c,a.adopt(h)]);if(this.options.j3){if(this.joinCounter===0){v.inject(document.id("joindtd"))}else{var i=document.id("joindtd").getElement("tbody");h.inject(i)}}else{var y=new Element("div",{id:"join"}).adopt(v);y.inject(document.id("joindtd"));if(m!==""){Browser.ie?a.hide():a.slide("hide")}this.updateJoinStatement(this.joinCounter)}this.joinCounter++},deleteJoin:function(c){var b,a;c.stop();if(this.options.j3){a=c.target.getParent("tr");b=c.target.getParent("table")}else{a=document.id(c.target.up(4))}a.dispose();if(this.options.j3){if(b.getElements("tbody tr").length===0){b.dispose()}}},watchJoins:function(){document.getElement("div[id^=table-sliders-data]").addEvent("change:relay(.join_from)",function(h,g){var a=g.getParent("table").id.replace("join","");this.updateJoinStatement(a);var d=g.get("value");var c=document.getElement("input[name*=connection_id]").get("value");var b="index.php?option=com_fabrik&format=raw&task=list.ajax_loadTableDropDown&table="+d+"&conn="+c;var f=new Request.HTML({url:b,method:"post",update:document.id("joinThisTableId"+a)}).send()}.bind(this));document.getElement("div[id^=table-sliders-data]").addEvent("change:relay(.join_to)",function(h,g){var a=g.getParent("table").id.replace("join","");this.updateJoinStatement(a);var d=g.get("value");var c=document.getElement("input[name*=connection_id]").get("value");var b="index.php?name=jform[params][table_join_key][]&option=com_fabrik&format=raw&task=list.ajax_loadTableDropDown&table="+d+"&conn="+c;var f=new Request.HTML({url:b,method:"post",update:document.id("joinJoinTableId"+a)}).send()}.bind(this));this.watchFieldList("join_type");this.watchFieldList("table_join_key");this.watchFieldList("table_key")},updateJoinStatement:function(d){var c=document.getElements("#join"+d+" .inputbox");var e=c[0].get("value");var f=c[1].get("value");var b=c[2].get("value");var h=c[3].get("value");var a=c[4].get("value");var g=e+" JOIN "+b+" ON "+f+"."+h+" = "+b+"."+a;document.id("join-desc-"+d).set("html",g)}});var adminFilters=new Class({Implements:[Options],options:{j3:false},initialize:function(c,a,b){this.el=document.id(c);this.fields=a;this.setOptions(b);this.filters=[];this.counter=0},addHeadings:function(){var a=new Element("thead").adopt(new Element("tr",{id:"filterTh","class":"title"}).adopt(new Element("th").set("text",Joomla.JText._("COM_FABRIK_JOIN")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_FIELD")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_CONDITION")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_VALUE")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_TYPE")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_APPLY_FILTER_TO")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_GROUPED")),new Element("th").set("text",Joomla.JText._("COM_FABRIK_DELETE"))));a.inject(document.id("filterContainer"),"before")},deleteFilterOption:function(d){d.stop();var a=d.target;a.removeEvent("click",function(f){this.deleteFilterOption(f)}.bind(this));var c=a.parentNode.parentNode;var b=c.parentNode;b.removeChild(c);this.counter--;if(this.counter===0){document.id("filterTh").dispose()}},_makeSel:function(g,a,e,d,f){var b=[];f=f===true?true:false;if(f){b.push(new Element("option",{value:""}).set("text",Joomla.JText._("COM_FABRIK_PLEASE_SELECT")))}e.each(function(c){if(c.value===d){b.push(new Element("option",{value:c.value,selected:"selected"}).set("text",c.label))}else{b.push(new Element("option",{value:c.value}).set("text",c.label))}});return new Element("select",{"class":g+" input-small",name:a}).adopt(b)},addFilterOption:function(C,t,u,d,r,v,E){var G,p,H,B,F,y,m;if(this.counter<=0){this.addHeadings()}C=C?C:"";t=t?t:"";u=u?u:"";d=d?d:"";r=r?r:"";E=E?E:"";var k=this.options.filterCondDd;var b=new Element("tr");if(this.counter>0){var s={type:"radio",name:"jform[params][filter-grouped]["+this.counter+"]",value:"1"};s.checked=(E==="1")?"checked":"";F=new Element("label").set("text",Joomla.JText._("JYES")).adopt(new Element("input",s));s={type:"radio",name:"jform[params][filter-grouped]["+this.counter+"]",value:"0"};s.checked=(E!=="1")?"checked":"";B=new Element("label").set("text",Joomla.JText._("JNO")).adopt(new Element("input",s))}if(this.counter===0){H=new Element("span").set("text","WHERE").adopt(new Element("input",{type:"hidden",id:"paramsfilter-join","class":"inputbox",name:"jform[params][filter-join][]",value:C}))}else{if(C==="AND"){G=new Element("option",{value:"AND",selected:"selected"}).set("text","AND");p=new Element("option",{value:"OR"}).set("text","OR")}else{G=new Element("option",{value:"AND"}).set("text","AND");p=new Element("option",{value:"OR",selected:"selected"}).set("text","OR")}H=new Element("select",{id:"paramsfilter-join","class":"inputbox  input-small",name:"jform[params][filter-join][]"}).adopt([G,p])}var x=new Element("td");var o=new Element("td");if(this.counter<=0){x.appendChild(new Element("input",{type:"hidden",name:"jform[params][filter-grouped]["+this.counter+"]",value:"0"}));x.appendChild(new Element("span").set("text","n/a"))}else{x.appendChild(B);x.appendChild(F)}o.appendChild(H);var h=new Element("td");h.innerHTML=this.fields;var g=new Element("td");g.innerHTML=k;var f=new Element("td");var e=new Element("td");e.innerHTML=this.options.filterAccess;var c=new Element("td");var A=new Element("textarea",{name:"jform[params][filter-value][]",cols:17,rows:4}).set("text",d);f.appendChild(A);f.appendChild(new Element("br"));var z=[{value:0,label:Joomla.JText._("COM_FABRIK_TEXT")},{value:1,label:Joomla.JText._("COM_FABRIK_EVAL")},{value:2,label:Joomla.JText._("COM_FABRIK_QUERY")},{value:3,label:Joomla.JText._("COM_FABRIK_NO_QUOTES")}];var q=new Element("td").adopt(this._makeSel("inputbox elementtype","jform[params][filter-eval][]",z,v,false));var n=(C!==""||t!==""||u!==""||d!=="")?true:false;var j=this.el.id+"-del-"+this.counter;var l=this.options.j3?"":Joomla.JText._("COM_FABRIK_DELETE");var w=this.options.j3?"btn btn-danger":"removeButton";var D='<button id="'+j+'" class="'+w+'"><i class="icon-minus"></i> '+l+"</button>";c.set("html",D);b.appendChild(o);b.appendChild(h);b.appendChild(g);b.appendChild(f);b.appendChild(q);b.appendChild(e);b.appendChild(x);b.appendChild(c);this.el.appendChild(b);document.id(j).addEvent("click",function(a){this.deleteFilterOption(a)}.bind(this));document.id(this.el.id+"-del-"+this.counter).click=function(a){this.deleteFilterOption(a)}.bind(this);if(C!==""){m=Array.from(o.getElementsByTagName("SELECT"));if(m.length>=1){for(y=0;y<m[0].length;y++){if(m[0][y].value===C){m[0].options.selectedIndex=y}}}}if(t!==""){m=Array.from(h.getElementsByTagName("SELECT"));if(m.length>=1){for(y=0;y<m[0].length;y++){if(m[0][y].value===t){m[0].options.selectedIndex=y}}}}if(u!==""){m=Array.from(g.getElementsByTagName("SELECT"));if(m.length>=1){for(y=0;y<m[0].length;y++){if(m[0][y].value===u){m[0].options.selectedIndex=y}}}}if(r!==""){m=Array.from(e.getElementsByTagName("SELECT"));if(m.length>=1){for(y=0;y<m[0].length;y++){if(m[0][y].value===r){m[0].options.selectedIndex=y}}}}this.counter++}});